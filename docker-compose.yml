version: '3.8'
services:
  app:
    build: .
    runtime: nvidia  # Specify the runtime for NVIDIA
    volumes:
      - MUSICGEN_ROOT:/app/MUSICGEN_ROOT
      - HF_HOME:/app/HF_HOME
      - container_cache:/root/.cache
      - venv:/app/audio-webui/venv
    command: "/app/run.sh"
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
    env_file:
      - .env
    ports:
      - "5859:7860"  # Changed to 5859 to avoid conflict
    stdin_open: true
    tty: true

volumes:
  MUSICGEN_ROOT:
  HF_HOME:
  container_cache:
  venv:
